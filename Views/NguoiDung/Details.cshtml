@* ~/Views/NguoiDung/Details.cshtml *@
@model NguoiDung

@{
    ViewData["Title"] = "Chi tiết người dùng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid px-4">
    <h1 class="mt-4">@ViewData["Title"]</h1>

    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a asp-controller="Admin" asp-action="Index">Dashboard</a></li>
        <li class="breadcrumb-item"><a asp-action="Index">Người dùng</a></li>
        <li class="breadcrumb-item active">Chi tiết</li>
    </ol>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-id-card me-1"></i>
                    Thông tin cơ bản
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-user-circle fa-5x text-primary"></i>
                        <h3 class="mt-2">@Model.HoTen</h3>
                        <span class="badge @(Model.Role == "Admin" ? "bg-danger" : "bg-info")">@(Model.Role == "Admin" ? "Quản trị viên" : "Bạn đọc")</span>
                    </div>

                    <table class="table table-bordered">
                        <tr>
                            <th style="width: 40%">Mã bạn đọc</th>
                            <td>@Model.MaBanDoc</td>
                        </tr>
                        <tr>
                            <th>Loại bạn đọc</th>
                            <td>@Model.LoaiBanDoc.TenLoai</td>
                        </tr>
                        <tr>
                            <th>Email</th>
                            <td>@Model.Email</td>
                        </tr>
                        <tr>
                            <th>Số điện thoại</th>
                            <td>@(String.IsNullOrEmpty(Model.SDT) ? "Chưa cập nhật" : Model.SDT)</td>
                        </tr>
                        <tr>
                            <th>Ngày sinh</th>
                            <td>@(Model.NgaySinh?.ToString("dd/MM/yyyy") ?? "Chưa cập nhật")</td>
                        </tr>
                        <tr>
                            <th>Giới tính</th>
                            <td>@(String.IsNullOrEmpty(Model.GioiTinh) ? "Chưa cập nhật" : Model.GioiTinh)</td>
                        </tr>
                    </table>

                    <div class="d-grid gap-2 mt-3">
                        <a asp-action="Edit" asp-route-id="@Model.ID" class="btn btn-primary">
                            <i class="fas fa-edit me-1"></i> Chỉnh sửa
                        </a>
                        <a asp-action="GiaHanThe" asp-route-id="@Model.ID" class="btn btn-success">
                            <i class="fas fa-calendar-plus me-1"></i> Gia hạn thẻ
                        </a>
                        <a asp-action="ResetPassword" asp-route-id="@Model.ID" class="btn btn-warning">
                            <i class="fas fa-key me-1"></i> Đặt lại mật khẩu
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-info-circle me-1"></i>
                    Thông tin chi tiết
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Thông tin học tập</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Khoa</th>
                                    <td>@(String.IsNullOrEmpty(Model.Khoa) ? "Chưa cập nhật" : Model.Khoa)</td>
                                </tr>
                                <tr>
                                    <th>Lớp</th>
                                    <td>@(String.IsNullOrEmpty(Model.Lop) ? "Chưa cập nhật" : Model.Lop)</td>
                                </tr>
                                <tr>
                                    <th>Ngành</th>
                                    <td>@(String.IsNullOrEmpty(Model.Nganh) ? "Chưa cập nhật" : Model.Nganh)</td>
                                </tr>
                                <tr>
                                    <th>Khóa học</th>
                                    <td>@(String.IsNullOrEmpty(Model.KhoaHoc) ? "Chưa cập nhật" : Model.KhoaHoc)</td>
                                </tr>
                                <tr>
                                    <th>Hệ chương trình</th>
                                    <td>@(String.IsNullOrEmpty(Model.HeChuongTrinh) ? "Chưa cập nhật" : Model.HeChuongTrinh)</td>
                                </tr>
                            </table>
                        </div>

                        <div class="col-md-6">
                            <h5>Thông tin thẻ thư viện</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Ngày đăng ký</th>
                                    <td>@Model.NgayThanhVien.ToString("dd/MM/yyyy")</td>
                                </tr>
                                <tr>
                                    <th>Ngày hết hạn</th>
                                    <td class="@(Model.NgayHetHan < DateTime.Now ? "text-danger" : "")">
                                        @Model.NgayHetHan.ToString("dd/MM/yyyy")
                                        @if (Model.NgayHetHan < DateTime.Now)
                                        {
                                            <span class="badge bg-danger ms-1">Đã hết hạn</span>
                                        }
                                        else if ((Model.NgayHetHan - DateTime.Now).TotalDays < 30)
                                        {
                                            <span class="badge bg-warning text-dark ms-1">Sắp hết hạn</span>
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <th>Mã phụ</th>
                                    <td>@(String.IsNullOrEmpty(Model.MaPhu) ? "Không có" : Model.MaPhu)</td>
                                </tr>
                                <tr>
                                    <th>Địa chỉ</th>
                                    <td>@(String.IsNullOrEmpty(Model.DiaChi) ? "Chưa cập nhật" : Model.DiaChi)</td>
                                </tr>
                                <tr>
                                    <th>Ghi chú</th>
                                    <td>@(String.IsNullOrEmpty(Model.GhiChu) ? "Không có" : Model.GhiChu)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-history me-1"></i>
                        Lịch sử mượn sách
                    </div>
                    <a href="#" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-list"></i> Xem tất cả
                    </a>
                </div>
                <div class="card-body">
                    <!-- Đây sẽ là nơi hiển thị lịch sử mượn sách của người dùng -->
                    <!-- Trong thực tế, bạn sẽ cần truy vấn và hiển thị dữ liệu từ bảng PhieuMuon -->
                    <div class="alert alert-info">
                        Chức năng xem lịch sử mượn sách đang được phát triển.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-1"></i> Quay lại danh sách
        </a>
    </div>
</div>